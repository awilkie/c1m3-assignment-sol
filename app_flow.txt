+--------------------------------------------------+
|                   Start                          |
+--------------------------------------------------+
                        |
                        v
+--------------------------------------------------+
| 1. generate_research_report_with_tools(prompt)   |
|                                                  |
|  Loop (Max Turns):                               |
|  +--------------------------------------------+  |
|  | LLM Call (with Tools)                      |  |
|  +----------------------+---------------------+  |
|                         |                        |
|        [Tool Calls?] ---+--- [No Tool Calls]     |
|             |                       |            |
|             v                       v            |
|  +--------------------+   +-------------------+  |
|  | Execute Tool       |   | Return Final Text |  |
|  | (Arxiv / Web)      |   | (Preliminary Rpt) |  |
|  +----------+---------+   +---------+---------+  |
|             |                       |            |
|             v                       |            |
|  +--------------------+             |            |
|  | Append Result to   |             |            |
|  | Messages           |             |            |
|  +----------+---------+             |            |
|             |                       |            |
|             v                       |            |
|      (Repeat Loop)                  |            |
|                                     |            |
+-------------------------------------+------------+
                        |
                        v
+--------------------------------------------------+
| 2. reflection_and_rewrite(preliminary_report)    |
|                                                  |
|  +--------------------------------------------+  |
|  | LLM Call (Reviewer Persona)                |  |
|  +----------------------+---------------------+  |
|                         |                        |
|                         v                        |
|  +--------------------------------------------+  |
|  | Parse JSON Output                          |  |
|  | { "reflection": ..., "revised_report": ...}|  |
|  +----------------------+---------------------+  |
|                         |                        |
|                         v                        |
|               Return Dict Results                |
+-------------------------+------------------------+
                        |
                        v
+--------------------------------------------------+
| 3. convert_report_to_html(revised_report)        |
|                                                  |
|  +--------------------------------------------+  |
|  | LLM Call (HTML Converter)                  |  |
|  +----------------------+---------------------+  |
|                         |                        |
|                         v                        |
|                Return HTML String                |
+-------------------------+------------------------+
                        |
                        v
+--------------------------------------------------+
|                    End                           |
|        (Display HTML & Print Reflection)         |
+--------------------------------------------------+
